
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    App.cable.subscriptions.create ({ channel: "SoundGroupChannel",
      id: "<%=current_user.sound_group_id%>"},{
        connected: () => {console.log("connected");},
        received: ({scheduled_time}) => {
          console.log("playing?");
          console.log(scheduled_time);
          let soundPlayer = document.getElementById('sound-player');
          window.navigator.geolocation.getCurrentPosition((time) => {
            scheduled_time=parseInt(scheduled_time)+5000;
            time=parseInt(time.timestamp);
            console.log(time);
            console.log(scheduled_time);
            console.log(scheduled_time-time);
            setTimeout(()=>{soundPlayer.play();}, scheduled_time-time);
          });
        }
     });
   });
  console.log("<%=current_user.sound_group_id%>");
</script>

<div class = 'sound-group-show-container' >
  <div>
    <label>Members:
      <div class = 'subscribed-users'>
        <% @users.each do |user| %>
          <%= user.username %>
        <% end %>
      </div>
    </label>
    <%= link_to "leave group", sound_groups_url %>
  </div>

  <div class = 'speaker-arrangement'>
    <% if current_user.id == @sound_group.leader.id %>
    <select name="tracklist">
      <% @tracks.each do |track| %>
        <option value="<%=track.id%>"><%=track.name%></option>
      <% end %>
    </select>
    <br>
    <button type="button">Play!</button>
    <% else  %>
      <h5>Sound Group Leader will determine the song. </h5>
    <% end %>
  <div>

  <div class = 'music player'>
    <div>
      <%=  %>
    </div>

    <div>
      <audio id="sound-player" src="http://www.pacdv.com/sounds/voices/okay-well.wav" controls>
      </audio>
    </div>

    <div>
      <button onClick=
        "$.ajax({url: '<%=current_user.sound_group_id%>/play'});"
        >Play without GEO</button>
      <button onClick="window.navigator.geolocation.getCurrentPosition((time) =>
        {$.ajax({url: '<%=current_user.sound_group_id%>/play', data: {time: time}})})"
        >Play with GEO</button>
    </div>

  </div>






</div>
